---
import BaseLayout from "../../layouts/BaseLayout.astro";

// Get all posts from both .md and .mdx files
const mdPosts = Object.values(
  import.meta.glob("../../posts/*.md", { eager: true })
);
const mdxPosts = Object.values(
  import.meta.glob("../../posts/mdx/*.mdx", { eager: true })
);

const allPosts = [...mdPosts, ...mdxPosts];

const { slug } = Astro.params;

const currentPost = allPosts.find((post: any) => {
  const filePath = post.file.split("/");
  const fileName = filePath[filePath.length - 1];
  const postSlug = fileName.replace(/\.(md|mdx)$/, "");
  return postSlug === slug;
}) as any;

if (!currentPost) {
  return Astro.redirect("/");
}
const { frontmatter } = currentPost;
---

<BaseLayout title={frontmatter.title} description={frontmatter.description}>
  <main class="min-h-screen w-full">
    <!-- Post Section -->
    <section
      class="px-7 pr-12 py-12 max-w-2xl mx-auto border-t border-gray-200"
    >
      <div class="w-full">
        <div class="mb-8">
          <div class="circle-container mb-8">
            <div class="rainbow-ring"></div>
          </div>
          <div
            class="flex flex-col md:flex-row md:items-baseline md:justify-between gap-8"
          >
            <div>
              <h1 class="text-2xl font-semibold mb-2 leading-tight">
                {frontmatter.title}
              </h1>
              {
                frontmatter.description && (
                  <p class="text-sm text-gray-600">{frontmatter.description}</p>
                )
              }
            </div>
            <div
              class="flex flex-row items-baseline gap-4 text-sm flex-shrink-0"
            >
              <a href="/" class="text-gray-600 hover:text-black"> ‚Üê Back </a>
            </div>
          </div>
        </div>
        <div class="markdown-content">
          <currentPost.Content />
        </div>
      </div>
    </section>
  </main>
</BaseLayout>

<style>
  /* Markdown content styling to match work section spacing */
  .markdown-content {
    font-size: 0.875rem;
    line-height: 1.625;
    color: #374151;
  }

  .markdown-content :global(p) {
    font-size: 0.875rem;
    line-height: 1.625;
    color: #374151;
    margin-bottom: 0;
  }

  .markdown-content :global(p + p) {
    margin-top: 0.625rem; /* gap-2.5 equivalent */
  }

  .markdown-content :global(h1),
  .markdown-content :global(h2),
  .markdown-content :global(h3),
  .markdown-content :global(h4),
  .markdown-content :global(h5),
  .markdown-content :global(h6) {
    font-size: 1rem;
    line-height: 1.5rem;
    font-weight: 500;
    color: #374151;
    margin-top: 1.5rem; /* space-y-6 equivalent */
    margin-bottom: 0.625rem; /* gap-2.5 equivalent */
  }

  .markdown-content :global(ul),
  .markdown-content :global(ol) {
    font-size: 0.875rem;
    line-height: 1.25rem;
    color: #374151;
    margin-top: 1.5rem;
    margin-bottom: 0;
    padding-left: 1.25rem;
  }

  .markdown-content :global(li) {
    font-size: 0.875rem;
    line-height: 1.25rem;
    color: #374151;
    margin-bottom: 0.625rem;
  }

  .markdown-content :global(ul li) {
    list-style-type: disc;
  }

  .markdown-content :global(ol li) {
    list-style-type: decimal;
  }

  .markdown-content :global(blockquote) {
    font-size: 0.875rem;
    line-height: 1.25rem;
    color: #4b5563;
    margin-top: 1.5rem;
    margin-bottom: 0;
    padding-left: 1rem;
    border-left: 2px solid #e5e7eb;
  }

  .markdown-content :global(blockquote p) {
    margin-bottom: 0.625rem;
  }

  .markdown-content :global(blockquote p:last-child) {
    margin-bottom: 0;
  }

  .markdown-content :global(pre) {
    font-size: 0.875rem;
    line-height: 1.25rem;
    color: #374151;
    margin-top: 1.5rem;
    margin-bottom: 0;
    padding: 1rem;
    background-color: #f9fafb;
    border-radius: 0.25rem;
    overflow-x: auto;
  }

  .markdown-content :global(code) {
    font-size: 0.875rem;
    line-height: 1.25rem;
    background-color: #f9fafb;
    padding: 0.125rem 0.25rem;
    border-radius: 0.25rem;
  }

  .markdown-content :global(pre code) {
    background-color: transparent;
    padding: 0;
  }

  .markdown-content :global(a) {
    color: #4b5563;
    text-decoration: underline;
  }

  .markdown-content :global(a:hover) {
    color: #000;
  }

  .markdown-content :global(strong) {
    font-weight: 500;
  }

  .markdown-content :global(em) {
    font-style: italic;
  }

  .markdown-content :global(hr) {
    margin-top: 1.5rem;
    margin-bottom: 1.5rem;
    border: none;
    border-top: 1px solid #e5e7eb;
  }

  .markdown-content :global(table) {
    font-size: 0.875rem;
    line-height: 1.25rem;
    color: #374151;
    margin-top: 1.5rem;
    margin-bottom: 0;
    width: 100%;
    border-collapse: collapse;
  }

  .markdown-content :global(th),
  .markdown-content :global(td) {
    font-size: 0.875rem;
    line-height: 1.25rem;
    color: #374151;
    padding: 0.5rem;
    border: 1px solid #e5e7eb;
  }

  .markdown-content :global(th) {
    font-weight: 500;
  }

  .markdown-content :global(img) {
    margin-top: 1.5rem;
    margin-bottom: 0;
    max-width: 100%;
    height: auto;
  }

  .circle-container {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    justify-content: center;
    gap: 0;
  }

  .rainbow-ring {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    box-shadow:
      0 4px 12px rgba(0, 0, 0, 0.15),
      0 2px 4px rgba(0, 0, 0, 0.1);
    background: conic-gradient(
      from 0deg,
      #ff3366,
      #ff6b35,
      #ffd23f,
      #06ffa5,
      #4ecdc4,
      #45b7d1,
      #96ceb4,
      #ffeaa7,
      #dda15e,
      #bc4749,
      #ff3366
    );
    position: relative;
    filter: drop-shadow(0 12px 24px rgba(0, 0, 0, 0.25))
      drop-shadow(0 6px 12px rgba(0, 0, 0, 0.15))
      drop-shadow(0 0 20px rgba(255, 255, 255, 0.1)) saturate(1.3)
      contrast(1.15) brightness(1.05);
    mask: radial-gradient(
      circle,
      transparent 18px,
      black 18px,
      black 24px,
      transparent 24px
    );
    -webkit-mask: radial-gradient(
      circle,
      transparent 18px,
      black 18px,
      black 24px,
      transparent 24px
    );
  }

  .rainbow-ring::before {
    content: "";
    position: absolute;
    inset: -2px;
    border-radius: 50%;
    background: radial-gradient(
      circle,
      rgba(255, 255, 255, 0.15) 0%,
      rgba(255, 255, 255, 0.05) 50%,
      transparent 70%
    );
    z-index: -1;
    filter: blur(12px);
    pointer-events: none;
  }
</style>
