---
import BaseLayout from "../../layouts/BaseLayout.astro";

// Get all posts from .md files
const mdPosts = Object.values(
  import.meta.glob("../../posts/*.md", { eager: true })
);

// Get WIP posts only in dev mode
const isDev = import.meta.env.DEV;
const wipPosts = isDev
  ? Object.values(import.meta.glob("../../posts/wip/*.md", { eager: true }))
  : [];

const allPosts = [...mdPosts, ...wipPosts];

const { slug } = Astro.params;

const currentPost = allPosts.find((post: any) => {
  const filePath = post.file.split("/");
  const fileName = filePath[filePath.length - 1];
  const postSlug = fileName.replace(/\.md$/, "");
  return postSlug === slug;
}) as any;

if (!currentPost) {
  return Astro.redirect("/");
}
const { frontmatter } = currentPost;
---

<BaseLayout title={frontmatter.title} description={frontmatter.description}>
  <main class="min-h-screen w-full">
    <!-- Post Section -->
    <section
      class="px-7 pr-12 py-12 max-w-2xl mx-auto border-t border-gray-200"
    >
      <div class="w-full">
        <div class="mb-8">
          <div class="circle-container mb-8">
            <div class="rainbow-ring"></div>
          </div>
          <div
            class="flex flex-col md:flex-row md:items-baseline md:justify-between gap-8"
          >
            <div>
              <h1 class="text-2xl font-semibold mb-2 leading-tight">
                {frontmatter.title}
              </h1>
              {
                frontmatter.description && (
                  <p class="text-sm text-gray-600">{frontmatter.description}</p>
                )
              }
            </div>
            <div
              class="flex flex-row items-baseline gap-4 text-sm flex-shrink-0"
            >
              <a href="/" class="text-gray-600 hover:text-black"> ‚Üê Back </a>
            </div>
          </div>
        </div>
        <div class="markdown-content">
          <currentPost.Content />
        </div>
      </div>
    </section>
  </main>
</BaseLayout>
